<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Dolly Zoom sur la France</title>
  <script src="https://cdn.jsdelivr.net/npm/cesium@1.120/Build/Cesium/Cesium.js"></script>
  <link href="https://cdn.jsdelivr.net/npm/cesium@1.120/Build/Cesium/Widgets/widgets.css" rel="stylesheet">
  <style>
    html, body, #cesiumContainer {
      width: 100%;
      height: 100%;
      margin: 0;
      padding: 0;
      overflow: hidden;
    }
  </style>
</head>
<body>
  <div id="cesiumContainer"></div>
  <script type="module">
    Cesium.Ion.defaultAccessToken = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJqdGkiOiJkOWI1ZTAyYS0xY2I2LTQ2YzEtOWQ1Yi03ZjA0OGYwN2FmMTUiLCJpZCI6MzQxMjI5LCJpYXQiOjE3NTc4NjI5MTl9.gmvZjoJSOqar_f22dkDwHs2HQBSzFAv40d9RRi5WpYM";

    const viewer = new Cesium.Viewer("cesiumContainer", {
      baseLayerPicker: false,
      terrainProvider: new Cesium.EllipsoidTerrainProvider(),
      timeline: false,
      animation: false
    });

    try {
      const imageryProvider = await Cesium.IonImageryProvider.fromAssetId(4);
      viewer.imageryLayers.addImageryProvider(imageryProvider);

      const camera = viewer.camera;
      const centerLat = 46.6;
      const centerLon = 2.5;

      // ðŸ“ Position initiale
      let baseDistance = 2000000; // 2000 km
      let amplitude = 1500000;    // oscillation +/- 1500 km
      let minFov = 15;            // champ de vision min en degrÃ©s
      let maxFov = 60;            // champ de vision max en degrÃ©s

      camera.setView({
        destination: Cesium.Cartesian3.fromDegrees(centerLon, centerLat, baseDistance)
      });

      // ðŸŽ¬ Dolly Zoom : distance varie ET fov varie de faÃ§on inverse
      viewer.scene.preRender.addEventListener(() => {
        const t = Date.now() * 0.001;
        const distance = baseDistance + Math.sin(t) * amplitude;

        // Calcul du FOV inversement proportionnel Ã  la distance
        const ratio = (distance - (baseDistance - amplitude)) / (2 * amplitude);
        const fov = minFov + (1 - ratio) * (maxFov - minFov);

        camera.setView({
          destination: Cesium.Cartesian3.fromDegrees(centerLon, centerLat, distance)
        });
        camera.frustum.fov = Cesium.Math.toRadians(fov);
      });

    } catch (error) {
      console.error("Erreur :", error);
    }
  </script>
</body>
</html>
